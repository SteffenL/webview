set(EXTERNAL_DIR ${CMAKE_SOURCE_DIR}/external)
set(TARGET_NAME webview_deps)
add_library(${TARGET_NAME} INTERFACE)

if(WIN32)
    list(APPEND CMAKE_PREFIX_PATH ${EXTERNAL_DIR}/Microsoft.Web.Webview2)
    find_path(WEBVIEW2_INCLUDE_DIRS NAMES WebView2.h REQUIRED)
    find_library(WEBVIEW2_STATIC_LIBRARY NAMES WebView2LoaderStatic REQUIRED)
    find_library(WEBVIEW2_SHARED_LIBRARY NAMES WebView2Loader REQUIRED)
    target_include_directories(${TARGET_NAME} INTERFACE ${WEBVIEW2_INCLUDE_DIRS})
    target_link_libraries(${TARGET_NAME} INTERFACE $<IF:$<BOOL:${USE_WEBVIEW2_SHARED_LIBRARY}>,${WEBVIEW2_SHARED_LIBRARY},${WEBVIEW2_STATIC_LIBRARY}>)
    target_compile_features(${TARGET_NAME} INTERFACE cxx_std_17)
    target_compile_definitions(${TARGET_NAME} INTERFACE WEBVIEW_EDGE)
elseif(APPLE)
    find_library(WEBKIT_LIBRARY WebKit REQUIRED)
    target_link_libraries(${TARGET_NAME} INTERFACE ${WEBKIT_LIBRARY})
    target_compile_definitions(${TARGET_NAME} INTERFACE WEBVIEW_COCOA)
elseif(UNIX)
    find_package(PkgConfig REQUIRED)
    pkg_check_modules(GTK REQUIRED gtk+-3.0)
    pkg_check_modules(WEBKIT2GTK REQUIRED webkit2gtk-4.0)
    target_include_directories(${TARGET_NAME} INTERFACE include ${WEBKIT2GTK_INCLUDE_DIRS})
    target_link_libraries(${TARGET_NAME} INTERFACE ${WEBKIT2GTK_LIBRARIES} pthread)
    target_compile_definitions(${TARGET_NAME} INTERFACE WEBVIEW_GTK)
endif()
