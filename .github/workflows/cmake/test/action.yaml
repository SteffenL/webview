name: CMake Test
inputs:
  build-dir:
    description: 'CMake build directory'
    required: true
    default: build
  build-type:
    description: 'Semicolon-separated CMake build types (Debug, Release, etc)'
    required: true
    default: Release
  shell:
    required: true
    default: bash
  test-wrapper-cmd:
    description: 'Wrapper command for running tests'
    required: false
runs:
  using: "composite"
  steps:
    - name: Test
      run: |
        wrapper_cmd=()
        if [[ ! -z "${{ inputs.test-wrapper-cmd }}" ]]; then
          wrapper_cmd+=("${{ inputs.test-wrapper-cmd }}")
        fi
        build_types="${{ inputs.build-type }}"
        build_types=(${build_types//;/ })
        for build_type in "${build_types[@]}"; do
          "${wrapper_cmd[@]}" ctest --test-dir "${{ inputs.build-dir }}" -C "${build_type}" --verbose --output-on-failure
        done
      shell: ${{ inputs.shell }}
